---
title: 窗体半透明控件不透明的例子
teaser: 这个例子以模态框显示透明效果，以钩子捕获在半透明区域的的鼠标事件，达到选择的效果.
---

### 半透明效果
	因为单个窗体无法实现窗体半透明，而其中的控件不透明的效果。所以根据网上用两个窗体来实现效果，将两个窗体的FormBorderStyle设为None，避免边框的影响。
	一个窗体通过设置背景色和Opacity属性来设置半透明程度。
	另一个窗体通过设置透明颜色属性TransparencyKey = BackColor来将除控件之外的区域全透明。(如果控件显示异常，将背景色改为其他单纯的颜色，控件背景中所没有的。)
	在显示的时候想办法让两个窗体重合就可以了。

***
### 钩子
	因为窗体的透明区域不响应鼠标事件，为了捕捉鼠标事件，这边使用系统鼠标钩子。
	对于鼠标和键盘钩子，我做了个简单封装。
	谈一下自己对鼠标/键盘钩子的认知。在我看来，这两者都同样分两种情况：一是系统钩子，称为全局钩子，系统捕捉到输入消息就能触发；另一个是应用程序钩子，即线程钩子，只有在应用程序收到并处理发往线程队列之前才会触发钩子回调。当我们用线程钩子捕获消息时，必须传递ui线程的id，因为消息由ui线程产生，只有传入ui线程的id才能捕获到。
	还有一点，全局鼠标钩子和线程鼠标钩子回调是返回内容参数结构不一致，需要区别对待。
	
	有一个钩子讲的很好的地址：[http://lib.csdn.net/article/csharp/68295](http://lib.csdn.net/article/csharp/68295)
	[msdn-hook](https://docs.microsoft.com/en-us/windows/desktop/api/winuser/ns-winuser-tagmousehookstructex)

***
### 更改系统鼠标
	如果在弹出模态框时，想更改鼠标图标来突出表示当前状态，那么透明区域的鼠标图标就无法通过窗体的属性来设置了，因为只有不透明的控件属于当前应用程序。那么我们需要通过更改当前系统的鼠标来实现效果，在退出时替换回去。
	如何从资源中加载一个鼠标图标文件呢，我是通过new Cursor(new MemoryStrem(Resource.Cursor1))这样来加载的。这边有个坑，有个工具叫ArtCursors，用来制作鼠标图标的，在winform中是无法加载的，报数据错误。在vs中，可以在新建项中新建鼠标图标文件。
	
	贴一个更改系统鼠标图标的地址：[替换系统鼠标图标](https://www.cnblogs.com/liang123/p/6325908.html#undefined)
	
***
### [例子地址](https://download.csdn.net/download/wanglantian1/10747915)

